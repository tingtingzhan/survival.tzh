---
title: "Package `survival.tzh`"
author: Tingting Zhan
date: today
format: 
  html:
    page-layout: full
    html-math-method: katex
toc: true
toc-location: left
toc-depth: 4
toc-title: ''
editor: source
knitr:
  opts_chunk: 
    collapse: true
    comment: "#>" 
vignette: >
  %\VignetteIndexEntry{intro}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

# Introduction

This vignette of package **`survival.tzh`** ([Github](https://github.com/tingtingzhan/survival.tzh), [RPubs](https://rpubs.com/tingtingzhan/VisualizeSimon2Stage)) documents ...

## Note to Users

Examples in this vignette require that the `search` path has

```{r}
library(survival.tzh)
#library(patchwork)
library(ggplot2)
library(flextable)
```

```{r}
#| echo: false
#options(mc.cores = 1L) # for CRAN submission
theme_minimal() |> 
  theme_set()
```

# Data Example

```{r}
rotterdam2 = survival::rotterdam |> 
  within.data.frame(expr = {
    meno = ifelse(meno, yes = 'postmenopausal', no = 'premenopausal')
    rtime = as.difftime(rtime, units = 'days')
    dtime = as.difftime(dtime, units = 'days')
    rfs = Surv(rtime, event = recur)
    os = Surv(dtime, event = death)
    units(rfs) = units(os) = 'years'
  })
```

# For `survfit` Object 

The `S3` methods for `'survfit'` object

-   function `autoplot.survfit()`

The `S3` methods for `'summary.survfit'` object

-   function `as_flextable.summary.survfit()`



## No Strata

```{r}
(s0 = survfit(os ~ 1, data = rotterdam2))
```

```{r}
#| fig-height: 4
s0 |> autoplot()
```

```{r}
ss0 = s0 |>
  summary(times = c(0, 5, 10, 15))
ss0
```

```{r}
ss0 |>
  as_flextable(which = 'n.risk')
```

```{r}
ss0 |>
  as_flextable(which = 'surv')
```

## One Strata

```{r}
(s1 = survfit(os ~ size, data = rotterdam2))
```



```{r}
#| fig-height: 4
s1 |> 
  autoplot()
```

```{r}
#| message: false
#| fig-height: 4
autoplot(s1) +
  scale_color_discrete(labels = letters[1:3]) + 
  scale_fill_discrete(labels = letters[1:3])
```

```{r}
ss1 = s1 |>
  summary(times = c(0, 5, 10, 15))
ss1
```

```{r}
ss1 |>
  as_flextable(which = 'n.risk')
```

```{r}
ss1 |>
  as_flextable(which = 'surv')
```

## Multiple Stratum

```{r}
(s2 = survfit(os ~ size + meno, data = rotterdam2))
```

```{r}
#| fig-height: 4
#| fig-width: 8
s2 |> 
  autoplot()
```



# For Multiple `survfit` Objects

Functions `subset_survfit()` and `msurvfit()` return an object of `S3` class `'survfitlist'`, i.e., a `listof` `survfit.object`s.


## Multiple Subsets

Function `subset_survfit()` applies function `survival::survfit()` to multiple subsets of the input `data`.

```{r}
s = subset_survfit(os ~ size, subset = list(
  All = TRUE, pre = (meno == 'premenopausal'), post = (meno == 'postmenopausal')
), data = rotterdam2)
```

```{r}
id = quote(list(
  All = TRUE, pre = (meno == 'premenopausal'), post = (meno == 'postmenopausal')
))
s1 = subset_survfit(os ~ size, subset = id, data = rotterdam2)
stopifnot(identical(s, s1))
```

The `S3` method `autoplot.survfitlist()` ..

```{r}
#| fig-width: 10
autoplot(s) + 
  patchwork::plot_layout(ncol = 2L)
```


```{r}
#| eval: false
#| echo: false
list(survfitlist = s) |>
  rmd.tzh::render_(file = 'survfitlist')
```



## Multiple Endpoints

Function `msurvfit()` applies function `survival::survfit()` to multiple endpoints.

```{r}
m = msurvfit(c(rfs, os) ~ meno, data = rotterdam2)
```

The `S3` method `autoplot.survfitlist()` ..

```{r}
#| fig-width: 10
m |> 
  autoplot()
```










# Appendix

## Terms & Abbreviations

| Term / Abbreviation | Description |
|------------------------------------|------------------------------------|
| [`flextable`](https://search.r-project.org/CRAN/refmans/flextable/html/flextable.html) | Flexible tables |
| [`survfit`](https://search.r-project.org/CRAN/refmans/survival/html/survfit.html), [`survfit.object`](https://search.r-project.org/CRAN/refmans/survival/html/survfit.object.html) [`summary.survfit`](https://search.r-project.org/CRAN/refmans/survival/html/summary.survfit.html) | Kaplan-Meier estimates |

